<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bill Tracker</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect } = React;
    const { createClient } = supabase;

    const SUPABASE_URL = 'https://ryfgwmvvevmcqlqnogze.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ5Zmd3bXZ2ZXZtY3FscW5vZ3plIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkzMzYyODcsImV4cCI6MjA3NDkxMjI4N30.8R4GkEK792hDWcu2v4aKL7f0hKfa1HKoD2b-vPd-qxc';
    
    const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const BillTracker = () => {
      const [user, setUser] = useState(null);
      const [loading, setLoading] = useState(true);
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [isSignUp, setIsSignUp] = useState(false);
      const [authError, setAuthError] = useState('');
      const [bills, setBills] = useState([]);
      const [showAddBill, setShowAddBill] = useState(false);
      const [selectedCategory, setSelectedCategory] = useState('all');
      const [showPasswords, setShowPasswords] = useState({});
      const [view, setView] = useState('upcoming');
      const [showSettings, setShowSettings] = useState(false);
      const [editingBill, setEditingBill] = useState(null);
      const [syncing, setSyncing] = useState(false);
      const [showImportExport, setShowImportExport] = useState(false);
      const [showProfileUpdate, setShowProfileUpdate] = useState(false);
      
      const [categoryNames, setCategoryNames] = useState({
        personal: 'Personal',
        business1: 'Business 1',
        business2: 'Business 2',
        business3: 'Business 3'
      });
      
      const [editingCategory, setEditingCategory] = useState(null);
      const [tempCategoryName, setTempCategoryName] = useState('');
      
      const [profileForm, setProfileForm] = useState({
        email: '',
        currentPassword: '',
        newPassword: '',
        confirmNewPassword: ''
      });
      const [profileError, setProfileError] = useState('');

      const [newBill, setNewBill] = useState({
        type: 'bill',
        vendor: '',
        category: 'personal',
        email: '',
        username: '',
        password: '',
        dueDate: '',
        amount: '',
        frequency: 'monthly',
        isRecurring: true,
        notes: '',
        balance: '',
        interestRate: '',
        term: '',
        accountType: 'loan'
      });

      useEffect(() => {
        checkUser();
        
        const { data: authListener } = supabaseClient.auth.onAuthStateChange((event, session) => {
          if (session?.user) {
            setUser(session.user);
            loadUserData(session.user.id);
          } else {
            setUser(null);
            setBills([]);
          }
        });

        return () => {
          authListener?.subscription?.unsubscribe();
        };
      }, []);

      const checkUser = async () => {
        try {
          const { data: { session } } = await supabaseClient.auth.getSession();
          if (session?.user) {
            setUser(session.user);
            await loadUserData(session.user.id);
          }
        } catch (error) {
          console.error('Error checking user:', error);
        } finally {
          setLoading(false);
        }
      };

      const loadUserData = async (userId) => {
        try {
          setSyncing(true);
          
          const { data: billsData, error: billsError } = await supabaseClient
            .from('bills')
            .select('*')
            .eq('user_id', userId)
            .order('due_date', { ascending: true });

          if (billsError) throw billsError;

          const billsWithHistory = await Promise.all(
            (billsData || []).map(async (bill) => {
              const { data: historyData } = await supabaseClient
                .from('bill_history')
                .select('*')
                .eq('bill_id', bill.id)
                .order('date', { ascending: false });
              
              return {
                ...bill,
                dueDate: bill.due_date,
                isRecurring: bill.is_recurring,
                interestRate: bill.interest_rate,
                accountType: bill.account_type,
                history: historyData || []
              };
            })
          );

          setBills(billsWithHistory);

          const { data: categoryData } = await supabaseClient
            .from('category_names')
            .select('*')
            .eq('user_id', userId)
            .single();

          if (categoryData) {
            setCategoryNames({
              personal: categoryData.personal,
              business1: categoryData.business1,
              business2: categoryData.business2,
              business3: categoryData.business3
            });
          }
        } catch (error) {
          console.error('Error loading data:', error);
        } finally {
          setSyncing(false);
        }
      };

      const handleSignUp = async () => {
        setAuthError('');
        if (!email || !password) {
          setAuthError('Please enter email and password');
          return;
        }

        if (password.length < 6) {
          setAuthError('Password must be at least 6 characters');
          return;
        }

        try {
          const { data, error } = await supabaseClient.auth.signUp({
            email,
            password,
          });

          if (error) throw error;

          setAuthError('✅ Check your email to confirm your account!');
        } catch (error) {
          setAuthError(error.message);
        }
      };

      const handleSignIn = async () => {
        setAuthError('');
        if (!email || !password) {
          setAuthError('Please enter email and password');
          return;
        }

        try {
          const { data, error } = await supabaseClient.auth.signInWithPassword({
            email,
            password,
          });

          if (error) throw error;
        } catch (error) {
          setAuthError(error.message);
        }
      };

      const handleSignOut = async () => {
        await supabaseClient.auth.signOut();
        setUser(null);
        setBills([]);
      };

      const saveBillToSupabase = async (bill) => {
        try {
          setSyncing(true);
          const billData = {
            id: bill.id,
            user_id: user.id,
            type: bill.type,
            vendor: bill.vendor,
            category: bill.category,
            email: bill.email,
            username: bill.username,
            password: bill.password,
            due_date: bill.dueDate,
            amount: bill.amount,
            frequency: bill.frequency,
            is_recurring: bill.isRecurring,
            notes: bill.notes,
            balance: bill.balance,
            interest_rate: bill.interestRate,
            term: bill.term,
            account_type: bill.accountType,
            paid: bill.paid,
            updated_at: new Date().toISOString()
          };

          const { error } = await supabaseClient
            .from('bills')
            .upsert(billData);

          if (error) throw error;

          if (bill.history && bill.history.length > 0) {
            const lastHistory = bill.history[bill.history.length - 1];
            if (!lastHistory.id) {
              const historyData = {
                bill_id: bill.id,
                user_id: user.id,
                date: lastHistory.date,
                amount: lastHistory.amount,
                type: lastHistory.type,
                previous_balance: lastHistory.previousBalance,
                new_balance: lastHistory.newBalance
              };

              await supabaseClient
                .from('bill_history')
                .insert(historyData);
            }
          }
        } catch (error) {
          console.error('Error saving bill:', error);
          alert('Error saving bill. Please try again.');
        } finally {
          setSyncing(false);
        }
      };

      const deleteBillFromSupabase = async (billId) => {
        try {
          setSyncing(true);
          const { error } = await supabaseClient
            .from('bills')
            .delete()
            .eq('id', billId)
            .eq('user_id', user.id);

          if (error) throw error;
        } catch (error) {
          console.error('Error deleting bill:', error);
        } finally {
          setSyncing(false);
        }
      };

      const saveCategoryNames = async (names) => {
        try {
          const { error } = await supabaseClient
            .from('category_names')
            .upsert({
              user_id: user.id,
              personal: names.personal,
              business1: names.business1,
              business2: names.business2,
              business3: names.business3,
              updated_at: new Date().toISOString()
            });

          if (error) throw error;
        } catch (error) {
          console.error('Error saving category names:', error);
        }
      };

      const exportData = () => {
        const exportData = {
          bills: bills.map(bill => ({
            ...bill,
            due_date: bill.dueDate,
            is_recurring: bill.isRecurring,
            interest_rate: bill.interestRate,
            account_type: bill.accountType
          })),
          categoryNames,
          exportDate: new Date().toISOString(),
          version: '2.0'
        };
        
        const dataStr = JSON.stringify(exportData, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `bill-tracker-backup-${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
        
        alert('✅ Data exported successfully!');
      };

      const importData = async (event) => {
        const file = event.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = async (e) => {
          try {
            const importedData = JSON.parse(e.target.result);
            
            if (!importedData.bills) {
              alert('❌ Invalid backup file format');
              return;
            }
            
            setSyncing(true);
            
            for (const bill of importedData.bills) {
              const billToSave = {
                ...bill,
                dueDate: bill.due_date || bill.dueDate,
                isRecurring: bill.is_recurring ?? bill.isRecurring,
                interestRate: bill.interest_rate || bill.interestRate,
                accountType: bill.account_type || bill.accountType,
                id: Date.now() + Math.random()
              };
              await saveBillToSupabase(billToSave);
            }
            
            if (importedData.categoryNames) {
              setCategoryNames(importedData.categoryNames);
              await saveCategoryNames(importedData.categoryNames);
            }
            
            await loadUserData(user.id);
            
            alert(`✅ Successfully imported ${importedData.bills.length} items!`);
            setShowImportExport(false);
          } catch (error) {
            console.error('Import error:', error);
            alert('❌ Error importing data. Please check the file format.');
          } finally {
            setSyncing(false);
          }
        };
        reader.readAsText(file);
      };

      const openProfileUpdate = () => {
        setProfileForm({
          email: user.email || '',
          currentPassword: '',
          newPassword: '',
          confirmNewPassword: ''
        });
        setProfileError('');
        setShowProfileUpdate(true);
      };

      const updateProfile = async () => {
        setProfileError('');
        
        try {
          if (profileForm.email && profileForm.email !== user.email) {
            const { error: emailError } = await supabaseClient.auth.updateUser({
              email: profileForm.email
            });
            if (emailError) throw emailError;
            setProfileError('✅ Check your new email for confirmation link!');
            return;
          }

          if (profileForm.newPassword) {
            if (!profileForm.currentPassword) {
              setProfileError('Please enter your current password');
              return;
            }
            
            const { error: signInError } = await supabaseClient.auth.signInWithPassword({
              email: user.email,
              password: profileForm.currentPassword
            });
            
            if (signInError) {
              setProfileError('Current password is incorrect');
              return;
            }
            
            if (profileForm.newPassword.length < 6) {
              setProfileError('New password must be at least 6 characters');
              return;
            }
            
            if (profileForm.newPassword !== profileForm.confirmNewPassword) {
              setProfileError('New passwords do not match');
              return;
            }
            
            const { error: passwordError } = await supabaseClient.auth.updateUser({
              password: profileForm.newPassword
            });
            
            if (passwordError) throw passwordError;
            
            setProfileError('✅ Password updated successfully!');
            setTimeout(() => {
              setShowProfileUpdate(false);
              setProfileError('');
            }, 2000);
          }
        } catch (error) {
          setProfileError(error.message);
        }
      };

      const formatDate = (dateString) => {
        if (!dateString) return '';
        const parts = dateString.split('-');
        const year = parts[0];
        const month = parts[1];
        const day = parts[2];
        return `${parseInt(month)}/${parseInt(day)}/${year}`;
      };

      const getNextDueDate = (currentDate, frequency) => {
        const parts = currentDate.split('-');
        const date = new Date(parseInt(parts[0]), parseInt(parts[1]) - 1, parseInt(parts[2]));
        
        switch(frequency) {
          case 'weekly':
            date.setDate(date.getDate() + 7);
            break;
          case 'monthly':
            date.setMonth(date.getMonth() + 1);
            break;
          case 'quarterly':
            date.setMonth(date.getMonth() + 3);
            break;
          case 'yearly':
            date.setFullYear(date.getFullYear() + 1);
            break;
          default:
            date.setMonth(date.getMonth() + 1);
        }
        
        const y = date.getFullYear();
        const m = String(date.getMonth() + 1).padStart(2, '0');
        const d = String(date.getDate()).padStart(2, '0');
        return `${y}-${m}-${d}`;
      };

      const addBill = async () => {
        const isValid = newBill.type === 'bill' 
          ? (newBill.vendor && newBill.amount && newBill.dueDate)
          : (newBill.vendor && newBill.balance);
          
        if (isValid) {
          const bill = {
            ...newBill,
            id: Date.now(),
            paid: false,
            history: []
          };
          
          await saveBillToSupabase(bill);
          setBills([...bills, bill]);
          
          setNewBill({
            type: 'bill',
            vendor: '',
            category: 'personal',
            email: '',
            username: '',
            password: '',
            dueDate: '',
            amount: '',
            frequency: 'monthly',
            isRecurring: true,
            notes: '',
            balance: '',
            interestRate: '',
            term: '',
            accountType: 'loan'
          });
          setShowAddBill(false);
        }
      };

      const updateBill = async () => {
        const isValid = newBill.type === 'bill' 
          ? (newBill.vendor && newBill.amount && newBill.dueDate)
          : (newBill.vendor && newBill.balance);
          
        if (isValid) {
          const updatedBills = bills.map(bill => 
            bill.id === editingBill.id 
              ? { ...bill, ...newBill }
              : bill
          );
          
          const updatedBill = updatedBills.find(b => b.id === editingBill.id);
          await saveBillToSupabase(updatedBill);
          setBills(updatedBills);
          
          setNewBill({
            type: 'bill',
            vendor: '',
            category: 'personal',
            email: '',
            username: '',
            password: '',
            dueDate: '',
            amount: '',
            frequency: 'monthly',
            isRecurring: true,
            notes: '',
            balance: '',
            interestRate: '',
            term: '',
            accountType: 'loan'
          });
          setEditingBill(null);
          setShowAddBill(false);
        }
      };

      const togglePaid = async (id) => {
        const bill = bills.find(b => b.id === id);
        const isAccount = bill.type === 'account';
        
        if (!bill.paid && bill.isRecurring) {
          const nextBill = {
            ...bill,
            id: Date.now(),
            dueDate: getNextDueDate(bill.dueDate, bill.frequency),
            paid: false,
            history: []
          };
          
          if (isAccount && bill.balance && bill.amount) {
            nextBill.balance = (parseFloat(bill.balance) - parseFloat(bill.amount)).toFixed(2);
          }
          
          const updatedCurrentBill = {
            ...bill,
            paid: true,
            history: [...(bill.history || []), {
              date: new Date().toISOString(),
              amount: bill.amount,
              type: 'payment',
              previousBalance: isAccount ? bill.balance : null,
              newBalance: isAccount && bill.balance && bill.amount 
                ? (parseFloat(bill.balance) - parseFloat(bill.amount)).toFixed(2) 
                : null
            }]
          };
          
          await saveBillToSupabase(updatedCurrentBill);
          await saveBillToSupabase(nextBill);
          
          setBills(bills.map(b => b.id === id ? updatedCurrentBill : b).concat(nextBill));
        } else {
          const updatedBill = {
            ...bill,
            paid: !bill.paid,
            history: !bill.paid ? [...(bill.history || []), {
              date: new Date().toISOString(),
              amount: bill.amount,
              type: 'payment',
              previousBalance: isAccount ? bill.balance : null,
              newBalance: isAccount && bill.balance && bill.amount 
                ? (parseFloat(bill.balance) - parseFloat(bill.amount)).toFixed(2) 
                : null
            }] : bill.history
          };
          
          await saveBillToSupabase(updatedBill);
          setBills(bills.map(b => b.id === id ? updatedBill : b));
        }
      };

      const deleteBill = async (id) => {
        if (confirm('Are you sure you want to delete this item?')) {
          await deleteBillFromSupabase(id);
          setBills(bills.filter(bill => bill.id !== id));
        }
      };

      const startEditingBill = (bill) => {
        setEditingBill(bill);
        setNewBill({
          type: bill.type || 'bill',
          vendor: bill.vendor,
          category: bill.category,
          email: bill.email || '',
          username: bill.username || '',
          password: bill.password || '',
          dueDate: bill.dueDate || '',
          amount: bill.amount || '',
          frequency: bill.frequency || 'monthly',
          isRecurring: bill.isRecurring !== false,
          notes: bill.notes || '',
          balance: bill.balance || '',
          interestRate: bill.interestRate || '',
          term: bill.term || '',
          accountType: bill.accountType || 'loan'
        });
        setShowAddBill(true);
      };

      const cancelEdit = () => {
        setEditingBill(null);
        setNewBill({
          type: 'bill',
          vendor: '',
          category: 'personal',
          email: '',
          username: '',
          password: '',
          dueDate: '',
          amount: '',
          frequency: 'monthly',
          isRecurring: true,
          notes: '',
          balance: '',
          interestRate: '',
          term: '',
          accountType: 'loan'
        });
        setShowAddBill(false);
      };

      const startEditingCategory = (categoryKey) => {
        setEditingCategory(categoryKey);
        setTempCategoryName(categoryNames[categoryKey]);
      };

      const saveCategoryName = async () => {
        if (tempCategoryName.trim() && editingCategory) {
          const newNames = {
            ...categoryNames,
            [editingCategory]: tempCategoryName.trim()
          };
          setCategoryNames(newNames);
          await saveCategoryNames(newNames);
          setEditingCategory(null);
          setTempCategoryName('');
        }
      };

      const cancelEditingCategory = () => {
        setEditingCategory(null);
        setTempCategoryName('');
      };

      const togglePasswordVisibility = (id) => {
        setShowPasswords(prev => ({ ...prev, [id]: !prev[id] }));
      };

      const calculateStatus = (dueDate, paid) => {
        if (!dueDate) return null;
        if (paid) return 'paid';
        const today = new Date();
        const parts = dueDate.split('-');
        const due = new Date(parseInt(parts[0]), parseInt(parts[1]) - 1, parseInt(parts[2]));
        const daysUntil = Math.ceil((due - today) / (1000 * 60 * 60 * 24));
        
        if (daysUntil < 0) return 'overdue';
        if (daysUntil <= 3) return 'due-soon';
        return 'upcoming';
      };

      const getStatusColor = (status) => {
        switch(status) {
          case 'overdue': return 'bg-red-100 text-red-800 border-red-300';
          case 'due-soon': return 'bg-yellow-100 text-yellow-800 border-yellow-300';
          case 'paid': return 'bg-green-100 text-green-800 border-green-300';
          default: return 'bg-blue-100 text-blue-800 border-blue-300';
        }
      };

      const filteredBills = bills.filter(bill => {
        if (selectedCategory !== 'all' && bill.category !== selectedCategory) return false;
        if (view === 'upcoming') return !bill.paid;
        if (view === 'paid') return bill.paid;
        return true;
      });

      const totalDue = filteredBills
        .filter(bill => !bill.paid && bill.amount)
        .reduce((sum, bill) => sum + parseFloat(bill.amount || 0), 0);
      
      const totalBalance = filteredBills
        .filter(bill => bill.type === 'account')
        .reduce((sum, bill) => sum + parseFloat(bill.balance || 0), 0);

      const categories = ['all', 'personal', 'business1', 'business2', 'business3'];

      if (loading) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center">
            <div className="text-center">
              <div className="text-6xl mb-4">💰</div>
              <div className="text-xl text-gray-700">Loading...</div>
            </div>
          </div>
        );
      }

      if (!user) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
            <div className="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
              <div className="text-center mb-8">
                <div className="bg-indigo-600 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 text-3xl">
                  💰
                </div>
                <h1 className="text-3xl font-bold text-gray-800">Bill Tracker</h1>
                <p className="text-gray-600 mt-2">
                  {isSignUp ? 'Create your account' : 'Welcome back'}
                </p>
              </div>
              
              <div className="space-y-4">
                {authError && (
                  <div className={`p-3 border rounded-lg ${
                    authError.includes('✅') 
                      ? 'bg-green-50 border-green-200 text-green-800' 
                      : 'bg-red-50 border-red-200 text-red-800'
                  }`}>
                    <p className="text-sm">{authError}</p>
                  </div>
                )}
                
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Email</label>
                  <input
                    type="email"
                    value={email}
                    onChange={(e) => setEmail(e.target.value)}
                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                    placeholder="your@email.com"
                  />
                </div>
                
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Password</label>
                  <input
                    type="password"
                    value={password}
                    onChange={(e) => setPassword(e.target.value)}
                    onKeyPress={(e) => e.key === 'Enter' && (isSignUp ? handleSignUp() : handleSignIn())}
                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                    placeholder={isSignUp ? "Minimum 6 characters" : "Enter password"}
                  />
                </div>
                
                <button
                  onClick={isSignUp ? handleSignUp : handleSignIn}
                  className="w-full bg-indigo-600 text-white py-3 rounded-lg hover:bg-indigo-700 transition font-semibold"
                >
                  {isSignUp ? 'Sign Up' : 'Sign In'}
                </button>
                
                <button
                  onClick={() => {
                    setIsSignUp(!isSignUp);
                    setAuthError('');
                  }}
                  className="w-full text-sm text-indigo-600 hover:text-indigo-700"
                >
                  {isSignUp ? 'Already have an account? Sign In' : 'Need an account? Sign Up'}
                </button>
              </div>
            </div>
          </div>
        );
      }

      return (
        <div className="min-h-screen bg-gray-50">
          <header className="bg-white shadow-sm border-b">
            <div className="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center flex-wrap gap-2">
              <div className="flex items-center gap-3">
                <div className="bg-indigo-600 p-2 rounded-lg text-2xl">
                  💰
                </div>
                <div>
                  <h1 className="text-2xl font-bold text-gray-800">Bill Tracker</h1>
                  <p className="text-sm text-gray-600">
                    {user.email} {syncing && <span className="text-indigo-600">• Syncing...</span>}
                  </p>
                </div>
              </div>
              <div className="flex gap-2">
                <button
                  onClick={() => setShowImportExport(true)}
                  className="px-4 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition flex items-center gap-2"
                >
                  <span>💾</span>
                  <span className="hidden sm:inline">Backup</span>
                </button>
                <button
                  onClick={() => setShowSettings(true)}
                  className="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition"
                >
                  ⚙️ Settings
                </button>
                <button
                  onClick={handleSignOut}
                  className="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition"
                >
                  Sign Out
                </button>
              </div>
            </div>
          </header>

          <main className="max-w-7xl mx-auto p-4 md:p-6">
            <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
              <div className="bg-white rounded-xl shadow p-6 border-l-4 border-indigo-500">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-gray-600 text-sm font-medium">Total Due</p>
                    <p className="text-3xl font-bold text-gray-800">${totalDue.toFixed(2)}</p>
                  </div>
                  <span className="text-3xl">📈</span>
                </div>
              </div>
              <div className="bg-white rounded-xl shadow p-6 border-l-4 border-teal-500">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-gray-600 text-sm font-medium">Total Balance</p>
                    <p className="text-3xl font-bold text-gray-800">${totalBalance.toFixed(2)}</p>
                  </div>
                  <span className="text-3xl">💰</span>
                </div>
              </div>
              <div className="bg-white rounded-xl shadow p-6 border-l-4 border-yellow-500">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-gray-600 text-sm font-medium">Upcoming Bills</p>
                    <p className="text-3xl font-bold text-gray-800">
                      {bills.filter(b => b.type !== 'account' && !b.paid).length}
                    </p>
                  </div>
                  <span className="text-3xl">📅</span>
                </div>
              </div>
              <div className="bg-white rounded-xl shadow p-6 border-l-4 border-green-500">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-gray-600 text-sm font-medium">Accounts</p>
                    <p className="text-3xl font-bold text-gray-800">
                      {bills.filter(b => b.type === 'account').length}
                    </p>
                  </div>
                  <span className="text-3xl">🏦</span>
                </div>
              </div>
            </div>

            <div className="bg-white rounded-xl shadow mb-6">
              <div className="p-4 border-b flex flex-wrap gap-2 items-center justify-between">
                <div className="flex gap-2 flex-wrap">
                  <button
                    onClick={() => setView('upcoming')}
                    className={`px-4 py-2 rounded-lg transition ${view === 'upcoming' ? 'bg-indigo-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}
                  >
                    Upcoming
                  </button>
                  <button
                    onClick={() => setView('paid')}
                    className={`px-4 py-2 rounded-lg transition ${view === 'paid' ? 'bg-indigo-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}
                  >
                    Paid
                  </button>
                  <button
                    onClick={() => setView('all')}
                    className={`px-4 py-2 rounded-lg transition ${view === 'all' ? 'bg-indigo-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}
                  >
                    All Items
                  </button>
                </div>
                <button
                  onClick={() => setShowAddBill(true)}
                  className="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition flex items-center gap-2"
                >
                  <span>➕</span>
                  Add New
                </button>
              </div>

              <div className="p-4 border-b">
                <div className="flex gap-2 flex-wrap">
                  {categories.map(cat => (
                    <button
                      key={cat}
                      onClick={() => setSelectedCategory(cat)}
                      className={`px-4 py-2 rounded-lg transition capitalize ${
                        selectedCategory === cat 
                          ? 'bg-indigo-100 text-indigo-700 border border-indigo-300' 
                          : 'bg-gray-50 text-gray-700 hover:bg-gray-100 border border-gray-200'
                      }`}
                    >
                      {cat === 'all' ? 'All' : categoryNames[cat]}
                    </button>
                  ))}
                </div>
              </div>

              <div className="overflow-x-auto">
                <table className="w-full">
                  <thead className="bg-gray-50 border-b">
                    <tr>
                      <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">Type</th>
                      <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">Status</th>
                      <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">Vendor/Account</th>
                      <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">Category</th>
                      <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">Details</th>
                      <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">Actions</th>
                    </tr>
                  </thead>
                  <tbody className="divide-y">
                    {filteredBills.length === 0 ? (
                      <tr>
                        <td colSpan="6" className="px-4 py-8 text-center text-gray-500">
                          No items found. Add your first bill or account!
                        </td>
                      </tr>
                    ) : (
                      filteredBills.map(bill => {
                        const status = calculateStatus(bill.dueDate, bill.paid);
                        const isBill = bill.type !== 'account';
                        return (
                          <tr key={bill.id} className="hover:bg-gray-50">
                            <td className="px-4 py-4">
                              <span className={`px-2 py-1 rounded text-xs font-semibold ${
                                isBill ? 'bg-purple-100 text-purple-700' : 'bg-teal-100 text-teal-700'
                              }`}>
                                {isBill ? '📄' : '💰'}
                              </span>
                            </td>
                            <td className="px-4 py-4">
                              {(isBill || bill.dueDate) && (
                                <span className={`px-3 py-1 rounded-full text-xs font-semibold border ${getStatusColor(status)}`}>
                                  {status === 'due-soon' ? 'Due Soon' : status?.charAt(0).toUpperCase() + status?.slice(1)}
                                </span>
                              )}
                            </td>
                            <td className="px-4 py-4">
                              <div className="font-medium text-gray-800">{bill.vendor}</div>
                              {bill.notes && <div className="text-sm text-gray-500">{bill.notes}</div>}
                            </td>
                            <td className="px-4 py-4">
                              <span className="inline-flex items-center gap-1 px-2 py-1 bg-gray-100 rounded text-sm">
                                {categoryNames[bill.category]}
                              </span>
                            </td>
                            <td className="px-4 py-4">
                              {isBill ? (
                                <div>
                                  <div className="text-sm text-gray-600">Due: {formatDate(bill.dueDate)}</div>
                                  <div className="font-semibold text-gray-800">${parseFloat(bill.amount).toFixed(2)}</div>
                                </div>
                              ) : (
                                <div>
                                  <div className="font-semibold text-gray-800">
                                    Balance: ${parseFloat(bill.balance || 0).toFixed(2)}
                                  </div>
                                </div>
                              )}
                            </td>
                            <td className="px-4 py-4">
                              <div className="flex gap-2">
                                <button
                                  onClick={() => startEditingBill(bill)}
                                  className="p-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition"
                                >
                                  ✏️
                                </button>
                                {(isBill || (bill.amount && bill.dueDate)) && (
                                  <button
                                    onClick={() => togglePaid(bill.id)}
                                    className={`p-2 rounded-lg transition ${
                                      bill.paid 
                                        ? 'bg-gray-100 text-gray-600 hover:bg-gray-200' 
                                        : 'bg-green-100 text-green-700 hover:bg-green-200'
                                    }`}
                                  >
                                    ✓
                                  </button>
                                )}
                                <button
                                  onClick={() => deleteBill(bill.id)}
                                  className="p-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition"
                                >
                                  🗑️
                                </button>
                              </div>
                            </td>
                          </tr>
                        );
                      })
                    )}
                  </tbody>
                </table>
              </div>
            </div>
          </main>

          {showSettings && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
              <div className="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                <div className="p-6 border-b flex justify-between items-center">
                  <h2 className="text-2xl font-bold text-gray-800">Settings</h2>
                  <button
                    onClick={() => {
                      setShowSettings(false);
                      setEditingCategory(null);
                    }}
                    className="p-2 hover:bg-gray-100 rounded-lg transition text-2xl"
                  >
                    ✕
                  </button>
                </div>
                
                <div className="p-6 border-b">
                  <div className="flex items-center justify-between mb-4">
                    <div>
                      <h3 className="text-lg font-semibold text-gray-800">Account Settings</h3>
                      <p className="text-sm text-gray-600">Manage your email and password</p>
                    </div>
                    <button
                      onClick={openProfileUpdate}
                      className="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition"
                    >
                      ✏️ Edit
                    </button>
                  </div>
                  <div className="bg-gray-50 rounded-lg p-4">
                    <div className="flex items-start gap-2">
                      <span className="text-gray-600 text-sm font-medium w-20">Email:</span>
                      <span className="text-gray-800">{user.email}</span>
                    </div>
                  </div>
                </div>
                
                <div className="p-6">
                  <h3 className="text-lg font-semibold text-gray-800 mb-4">Category Names</h3>
                  <div className="space-y-3">
                    {Object.keys(categoryNames).map(catKey => (
                      <div key={catKey} className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                        <div className="flex-1">
                          {editingCategory === catKey ? (
                            <input
                              type="text"
                              value={tempCategoryName}
                              onChange={(e) => setTempCategoryName(e.target.value)}
                              onKeyPress={(e) => e.key === 'Enter' && saveCategoryName()}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg"
                              autoFocus
                            />
                          ) : (
                            <span className="font-medium text-gray-800">{categoryNames[catKey]}</span>
                          )}
                        </div>
                        <div className="flex gap-2">
                          {editingCategory === catKey ? (
                            <>
                              <button
                                onClick={saveCategoryName}
                                className="p-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200"
                              >
                                ✓
                              </button>
                              <button
                                onClick={cancelEditingCategory}
                                className="p-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200"
                              >
                                ✕
                              </button>
                            </>
                          ) : (
                            <button
                              onClick={() => startEditingCategory(catKey)}
                              className="p-2 bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200"
                            >
                              ✏️
                            </button>
                          )}
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
                
                <div className="p-6 border-t flex justify-end">
                  <button
                    onClick={() => {
                      setShowSettings(false);
                      setEditingCategory(null);
                    }}
                    className="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition"
                  >
                    Done
                  </button>
                </div>
              </div>
            </div>
          )}

          {showProfileUpdate && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
              <div className="bg-white rounded-xl shadow-2xl max-w-md w-full">
                <div className="p-6 border-b">
                  <h2 className="text-2xl font-bold text-gray-800">Update Account</h2>
                  <p className="text-sm text-gray-600 mt-2">Change your email or password</p>
                </div>
                <div className="p-6 space-y-4">
                  {profileError && (
                    <div className={`p-3 border rounded-lg ${
                      profileError.includes('✅')
                        ? 'bg-green-50 border-green-200 text-green-800'
                        : 'bg-red-50 border-red-200 text-red-800'
                    }`}>
                      <p className="text-sm">{profileError}</p>
                    </div>
                  )}
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input
                      type="email"
                      value={profileForm.email}
                      onChange={(e) => setProfileForm({...profileForm, email: e.target.value})}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                      placeholder={user.email}
                    />
                    <p className="text-xs text-gray-500 mt-1">Change will require email confirmation</p>
                  </div>
                  
                  <div className="pt-4 border-t">
                    <h3 className="text-sm font-semibold text-gray-700 mb-3">Change Password</h3>
                    
                    <div className="space-y-3">
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">Current Password</label>
                        <input
                          type="password"
                          value={profileForm.currentPassword}
                          onChange={(e) => setProfileForm({...profileForm, currentPassword: e.target.value})}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                          placeholder="Enter current password"
                        />
                      </div>
                      
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">New Password</label>
                        <input
                          type="password"
                          value={profileForm.newPassword}
                          onChange={(e) => setProfileForm({...profileForm, newPassword: e.target.value})}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                          placeholder="Minimum 6 characters"
                        />
                      </div>
                      
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">Confirm New Password</label>
                        <input
                          type="password"
                          value={profileForm.confirmNewPassword}
                          onChange={(e) => setProfileForm({...profileForm, confirmNewPassword: e.target.value})}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                          placeholder="Re-enter new password"
                        />
                      </div>
                    </div>
                  </div>
                </div>
                <div className="p-6 border-t flex gap-3 justify-end">
                  <button
                    onClick={() => {
                      setShowProfileUpdate(false);
                      setProfileError('');
                      setProfileForm({
                        email: '',
                        currentPassword: '',
                        newPassword: '',
                        confirmNewPassword: ''
                      });
                    }}
                    className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition"
                  >
                    Cancel
                  </button>
                  <button
                    onClick={updateProfile}
                    className="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition"
                  >
                    Save Changes
                  </button>
                </div>
              </div>
            </div>
          )}

          {showImportExport && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
              <div className="bg-white rounded-xl shadow-2xl max-w-md w-full">
                <div className="p-6 border-b">
                  <div className="flex justify-between items-start">
                    <div>
                      <h2 className="text-2xl font-bold text-gray-800">Backup & Restore</h2>
                      <p className="text-sm text-gray-600 mt-1">Export or import your data</p>
                    </div>
                    <button
                      onClick={() => setShowImportExport(false)}
                      className="p-2 hover:bg-gray-100 rounded-lg transition text-2xl"
                    >
                      ✕
                    </button>
                  </div>
                </div>
                <div className="p-6 space-y-4">
                  <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h3 className="font-semibold text-gray-800 mb-2">💾 Export Data</h3>
                    <p className="text-sm text-gray-600 mb-3">
                      Download all your bills, accounts, and categories as a backup file.
                    </p>
                    <button
                      onClick={exportData}
                      className="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium"
                    >
                      Download Backup File
                    </button>
                  </div>
                  
                  <div className="bg-green-50 border border-green-200 rounded-lg p-4">
                    <h3 className="font-semibold text-gray-800 mb-2">📥 Import Data</h3>
                    <p className="text-sm text-gray-600 mb-3">
                      Restore data from a backup file. This will add to your existing bills.
                    </p>
                    <label className="block">
                      <input
                        type="file"
                        accept=".json"
                        onChange={importData}
                        className="hidden"
                      />
                      <span className="w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition font-medium cursor-pointer inline-block text-center">
                        Choose Backup File
                      </span>
                    </label>
                  </div>
                  
                  <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                    <p className="text-xs text-yellow-800">
                      <strong>💡 Tip:</strong> Your data is automatically synced to the cloud. Use export for extra backups or to migrate between accounts.
                    </p>
                  </div>
                </div>
                <div className="p-6 border-t">
                  <button
                    onClick={() => setShowImportExport(false)}
                    className="w-full px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition"
                  >
                    Close
                  </button>
                </div>
              </div>
            </div>
          )}

          {showAddBill && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
              <div className="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                <div className="p-6 border-b flex justify-between items-center">
                  <h2 className="text-2xl font-bold text-gray-800">
                    {editingBill ? 'Edit' : 'Add'} {newBill.type === 'account' ? 'Account' : 'Bill'}
                  </h2>
                  <button onClick={cancelEdit} className="p-2 hover:bg-gray-100 rounded-lg text-2xl">
                    ✕
                  </button>
                </div>
                <div className="p-6 space-y-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">Type</label>
                    <div className="flex gap-4">
                      <label className="flex items-center gap-2">
                        <input
                          type="radio"
                          value="bill"
                          checked={newBill.type === 'bill'}
                          onChange={(e) => setNewBill({...newBill, type: e.target.value})}
                        />
                        <span>📄 Bill</span>
                      </label>
                      <label className="flex items-center gap-2">
                        <input
                          type="radio"
                          value="account"
                          checked={newBill.type === 'account'}
                          onChange={(e) => setNewBill({...newBill, type: e.target.value})}
                        />
                        <span>💰 Account</span>
                      </label>
                    </div>
                  </div>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">
                        {newBill.type === 'bill' ? 'Vendor' : 'Account Name'} *
                      </label>
                      <input
                        type="text"
                        value={newBill.vendor}
                        onChange={(e) => setNewBill({...newBill, vendor: e.target.value})}
                        className="w-full px-4 py-2 border rounded-lg"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">Category</label>
                      <select
                        value={newBill.category}
                        onChange={(e) => setNewBill({...newBill, category: e.target.value})}
                        className="w-full px-4 py-2 border rounded-lg"
                      >
                        <option value="personal">{categoryNames.personal}</option>
                        <option value="business1">{categoryNames.business1}</option>
                        <option value="business2">{categoryNames.business2}</option>
                        <option value="business3">{categoryNames.business3}</option>
                      </select>
                    </div>
                    
                    {newBill.type === 'account' ? (
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">Balance *</label>
                        <input
                          type="number"
                          step="0.01"
                          value={newBill.balance}
                          onChange={(e) => setNewBill({...newBill, balance: e.target.value})}
                          className="w-full px-4 py-2 border rounded-lg"
                        />
                      </div>
                    ) : (
                      <>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">Amount *</label>
                          <input
                            type="number"
                            step="0.01"
                            value={newBill.amount}
                            onChange={(e) => setNewBill({...newBill, amount: e.target.value})}
                            className="w-full px-4 py-2 border rounded-lg"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">Due Date *</label>
                          <input
                            type="date"
                            value={newBill.dueDate}
                            onChange={(e) => setNewBill({...newBill, dueDate: e.target.value})}
                            className="w-full px-4 py-2 border rounded-lg"
                          />
                        </div>
                      </>
                    )}
                    
                    <div className="md:col-span-2">
                      <label className="block text-sm font-medium text-gray-700 mb-2">Notes</label>
                      <textarea
                        value={newBill.notes}
                        onChange={(e) => setNewBill({...newBill, notes: e.target.value})}
                        className="w-full px-4 py-2 border rounded-lg"
                        rows="3"
                      />
                    </div>
                  </div>
                </div>
                <div className="p-6 border-t flex gap-3 justify-end">
                  <button
                    onClick={cancelEdit}
                    className="px-6 py-2 border rounded-lg hover:bg-gray-50"
                  >
                    Cancel
                  </button>
                  <button
                    onClick={editingBill ? updateBill : addBill}
                    className="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700"
                  >
                    {editingBill ? 'Update' : 'Add'}
                  </button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };

    ReactDOM.render(<BillTracker />, document.getElementById('root'));
  </script>
</body>
</html>
