<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bill Tracker</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect } = React;

    const BillTracker = () => {
      const [isLoggedIn, setIsLoggedIn] = useState(false);
      const [username, setUsername] = useState('');
      const [password, setPassword] = useState('');
      const [isSignupMode, setIsSignupMode] = useState(false);
      const [loginError, setLoginError] = useState('');
      const [confirmPassword, setConfirmPassword] = useState('');
      const [fullName, setFullName] = useState('');
      const [email, setEmail] = useState('');
      const [bills, setBills] = useState([]);
      const [showAddBill, setShowAddBill] = useState(false);
      const [selectedCategory, setSelectedCategory] = useState('all');
      const [showPasswords, setShowPasswords] = useState({});
      const [view, setView] = useState('upcoming');
      const [showSettings, setShowSettings] = useState(false);
      const [editingBill, setEditingBill] = useState(null);
      const [showCalendar, setShowCalendar] = useState(false);
      const [calendarDate, setCalendarDate] = useState(new Date());
      const [selectedDayBills, setSelectedDayBills] = useState(null);
      
      const [categoryNames, setCategoryNames] = useState({
        personal: 'Personal',
        business1: 'Business 1',
        business2: 'Business 2',
        business3: 'Business 3'
      });
      
      const [editingCategory, setEditingCategory] = useState(null);
      const [tempCategoryName, setTempCategoryName] = useState('');
      const [showBalanceUpdate, setShowBalanceUpdate] = useState(false);
      const [balanceUpdateId, setBalanceUpdateId] = useState(null);
      const [newBalance, setNewBalance] = useState('');
      const [showHistory, setShowHistory] = useState(false);
      const [historyBill, setHistoryBill] = useState(null);
      const [showProfileUpdate, setShowProfileUpdate] = useState(false);
      const [profileForm, setProfileForm] = useState({
        fullName: '',
        email: '',
        currentPassword: '',
        newPassword: '',
        confirmNewPassword: ''
      });
      const [profileError, setProfileError] = useState('');

      const [newBill, setNewBill] = useState({
        type: 'bill',
        vendor: '',
        category: 'personal',
        email: '',
        username: '',
        password: '',
        dueDate: '',
        amount: '',
        frequency: 'monthly',
        isRecurring: true,
        notes: '',
        balance: '',
        interestRate: '',
        term: '',
        accountType: 'loan'
      });

      const formatDate = (dateString) => {
        const parts = dateString.split('-');
        const year = parts[0];
        const month = parts[1];
        const day = parts[2];
        return `${parseInt(month)}/${parseInt(day)}/${year}`;
      };

      const getNextDueDate = (currentDate, frequency) => {
        const parts = currentDate.split('-');
        const date = new Date(parseInt(parts[0]), parseInt(parts[1]) - 1, parseInt(parts[2]));
        
        switch(frequency) {
          case 'weekly':
            date.setDate(date.getDate() + 7);
            break;
          case 'monthly':
            date.setMonth(date.getMonth() + 1);
            break;
          case 'quarterly':
            date.setMonth(date.getMonth() + 3);
            break;
          case 'yearly':
            date.setFullYear(date.getFullYear() + 1);
            break;
          default:
            date.setMonth(date.getMonth() + 1);
        }
        
        const y = date.getFullYear();
        const m = String(date.getMonth() + 1).padStart(2, '0');
        const d = String(date.getDate()).padStart(2, '0');
        return `${y}-${m}-${d}`;
      };

      useEffect(() => {
        const savedBills = localStorage.getItem('bills');
        const savedCreds = localStorage.getItem('userCredentials');
        const activeSession = localStorage.getItem('activeSession');
        const savedCategoryNames = localStorage.getItem('categoryNames');
        
        if (savedBills) setBills(JSON.parse(savedBills));
        if (savedCategoryNames) setCategoryNames(JSON.parse(savedCategoryNames));
        
        // Check if user already exists
        if (!savedCreds) {
          setIsSignupMode(true);
        }
        
        if (activeSession === 'true' && savedCreds) {
          const creds = JSON.parse(savedCreds);
          setUsername(creds.username);
          setFullName(creds.fullName || '');
          setEmail(creds.email || '');
          setIsLoggedIn(true);
        }
      }, []);

      useEffect(() => {
        if (bills.length > 0) {
          localStorage.setItem('bills', JSON.stringify(bills));
        }
      }, [bills]);

      useEffect(() => {
        localStorage.setItem('categoryNames', JSON.stringify(categoryNames));
      }, [categoryNames]);

      const handleLogin = () => {
        setLoginError('');
        
        if (!username || !password) {
          setLoginError('Please enter both username and password');
          return;
        }

        const savedCreds = localStorage.getItem('userCredentials');

        if (!savedCreds) {
          setLoginError('No account found. Please sign up first.');
          return;
        }

        const creds = JSON.parse(savedCreds);
        if (creds.username === username && creds.password === password) {
          localStorage.setItem('activeSession', 'true');
          setFullName(creds.fullName || '');
          setEmail(creds.email || '');
          setIsLoggedIn(true);
        } else {
          setLoginError('Incorrect username or password');
          setPassword('');
        }
      };

      const handleSignup = () => {
        setLoginError('');
        
        if (!username || !password) {
          setLoginError('Please enter username and password');
          return;
        }

        if (password !== confirmPassword) {
          setLoginError('Passwords do not match');
          return;
        }

        if (password.length < 6) {
          setLoginError('Password must be at least 6 characters');
          return;
        }

        const savedCreds = localStorage.getItem('userCredentials');
        if (savedCreds) {
          setLoginError('An account already exists. Please login instead.');
          return;
        }

        const credentials = { 
          username, 
          password,
          fullName: fullName || '',
          email: email || ''
        };
        localStorage.setItem('userCredentials', JSON.stringify(credentials));
        localStorage.setItem('activeSession', 'true');
        setIsLoggedIn(true);
        setIsSignupMode(false);
      };

      const handleLogout = () => {
        setIsLoggedIn(false);
        setUsername('');
        setPassword('');
        setFullName('');
        setEmail('');
        localStorage.setItem('activeSession', 'false');
      };

      const startEditingCategory = (categoryKey) => {
        setEditingCategory(categoryKey);
        setTempCategoryName(categoryNames[categoryKey]);
      };

      const saveCategoryName = () => {
        if (tempCategoryName.trim() && editingCategory) {
          setCategoryNames({
            ...categoryNames,
            [editingCategory]: tempCategoryName.trim()
          });
          setEditingCategory(null);
          setTempCategoryName('');
        }
      };

      const cancelEditingCategory = () => {
        setEditingCategory(null);
        setTempCategoryName('');
      };

      const addBill = () => {
        const isValid = newBill.type === 'bill' 
          ? (newBill.vendor && newBill.amount && newBill.dueDate)
          : (newBill.vendor && newBill.balance);
          
        if (isValid) {
          const bill = {
            ...newBill,
            id: Date.now(),
            paid: false,
            history: []
          };
          setBills([...bills, bill]);
          setNewBill({
            type: 'bill',
            vendor: '',
            category: 'personal',
            email: '',
            username: '',
            password: '',
            dueDate: '',
            amount: '',
            frequency: 'monthly',
            isRecurring: true,
            notes: '',
            balance: '',
            interestRate: '',
            term: '',
            accountType: 'loan'
          });
          setShowAddBill(false);
        }
      };

      const startEditingBill = (bill) => {
        setEditingBill(bill);
        setNewBill({
          type: bill.type || 'bill',
          vendor: bill.vendor,
          category: bill.category,
          email: bill.email || '',
          username: bill.username || '',
          password: bill.password || '',
          dueDate: bill.dueDate || '',
          amount: bill.amount || '',
          frequency: bill.frequency || 'monthly',
          isRecurring: bill.isRecurring !== false,
          notes: bill.notes || '',
          balance: bill.balance || '',
          interestRate: bill.interestRate || '',
          term: bill.term || '',
          accountType: bill.accountType || 'loan'
        });
        setShowAddBill(true);
      };

      const updateBill = () => {
        const isValid = newBill.type === 'bill' 
          ? (newBill.vendor && newBill.amount && newBill.dueDate)
          : (newBill.vendor && newBill.balance);
          
        if (isValid) {
          setBills(bills.map(bill => 
            bill.id === editingBill.id 
              ? { ...bill, ...newBill }
              : bill
          ));
          setNewBill({
            type: 'bill',
            vendor: '',
            category: 'personal',
            email: '',
            username: '',
            password: '',
            dueDate: '',
            amount: '',
            frequency: 'monthly',
            isRecurring: true,
            notes: '',
            balance: '',
            interestRate: '',
            term: '',
            accountType: 'loan'
          });
          setEditingBill(null);
          setShowAddBill(false);
        }
      };

      const cancelEdit = () => {
        setEditingBill(null);
        setNewBill({
          type: 'bill',
          vendor: '',
          category: 'personal',
          email: '',
          username: '',
          password: '',
          dueDate: '',
          amount: '',
          frequency: 'monthly',
          isRecurring: true,
          notes: '',
          balance: '',
          interestRate: '',
          term: '',
          accountType: 'loan'
        });
        setShowAddBill(false);
      };

      const togglePaid = (id) => {
        const bill = bills.find(b => b.id === id);
        const isAccount = bill.type === 'account';
        
        if (!bill.paid && bill.isRecurring) {
          const nextBill = {
            ...bill,
            id: Date.now(),
            dueDate: getNextDueDate(bill.dueDate, bill.frequency),
            paid: false,
            history: []
          };
          
          // If it's an account with a balance, reduce the balance by the payment amount
          if (isAccount && bill.balance && bill.amount) {
            nextBill.balance = (parseFloat(bill.balance) - parseFloat(bill.amount)).toFixed(2);
          }
          
          setBills(bills.map(b => {
            if (b.id === id) {
              return {
                ...b,
                paid: true,
                history: [...(b.history || []), {
                  date: new Date().toISOString(),
                  amount: b.amount,
                  type: 'payment',
                  previousBalance: isAccount ? b.balance : null,
                  newBalance: isAccount && b.balance && b.amount 
                    ? (parseFloat(b.balance) - parseFloat(b.amount)).toFixed(2) 
                    : null
                }]
              };
            }
            return b;
          }).concat(nextBill));
        } else {
          setBills(bills.map(bill => {
            if (bill.id === id) {
              const updatedBill = { ...bill, paid: !bill.paid };
              if (!bill.paid) {
                const isAcct = bill.type === 'account';
                updatedBill.history = [...(bill.history || []), {
                  date: new Date().toISOString(),
                  amount: bill.amount,
                  type: 'payment',
                  previousBalance: isAcct ? bill.balance : null,
                  newBalance: isAcct && bill.balance && bill.amount 
                    ? (parseFloat(bill.balance) - parseFloat(bill.amount)).toFixed(2) 
                    : null
                }];
              }
              return updatedBill;
            }
            return bill;
          }));
        }
      };

      const deleteBill = (id) => {
        if (confirm('Are you sure you want to delete this item?')) {
          setBills(bills.filter(bill => bill.id !== id));
        }
      };

      const openBalanceUpdate = (id) => {
        const bill = bills.find(b => b.id === id);
        setBalanceUpdateId(id);
        setNewBalance(bill.balance || '');
        setShowBalanceUpdate(true);
      };

      const updateBalance = () => {
        if (newBalance && balanceUpdateId) {
          setBills(bills.map(bill => {
            if (bill.id === balanceUpdateId) {
              return {
                ...bill,
                balance: newBalance,
                history: [...(bill.history || []), {
                  date: new Date().toISOString(),
                  amount: null,
                  type: 'balance_update',
                  previousBalance: bill.balance,
                  newBalance: newBalance
                }]
              };
            }
            return bill;
          }));
          setShowBalanceUpdate(false);
          setBalanceUpdateId(null);
          setNewBalance('');
        }
      };

      const openHistory = (bill) => {
        setHistoryBill(bill);
        setShowHistory(true);
      };

      const getDaysInMonth = (date) => {
        const year = date.getFullYear();
        const month = date.getMonth();
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const daysInMonth = lastDay.getDate();
        const startingDayOfWeek = firstDay.getDay();
        
        const days = [];
        
        // Add empty cells for days before month starts
        for (let i = 0; i < startingDayOfWeek; i++) {
          days.push(null);
        }
        
        // Add all days in month
        for (let day = 1; day <= daysInMonth; day++) {
          days.push(new Date(year, month, day));
        }
        
        return days;
      };

      const getBillsForDate = (date) => {
        if (!date) return [];
        const dateStr = date.toISOString().split('T')[0];
        return bills.filter(bill => {
          if (!bill.dueDate) return false;
          return bill.dueDate === dateStr;
        });
      };

      const handleDayClick = (date) => {
        if (!date) return;
        const dayBills = getBillsForDate(date);
        if (dayBills.length > 0) {
          setSelectedDayBills({ date, bills: dayBills });
        }
      };

      const changeMonth = (direction) => {
        const newDate = new Date(calendarDate);
        newDate.setMonth(newDate.getMonth() + direction);
        setCalendarDate(newDate);
      };

      const goToToday = () => {
        setCalendarDate(new Date());
      };

      const openProfileUpdate = () => {
        setProfileForm({
          fullName: fullName || '',
          email: email || '',
          currentPassword: '',
          newPassword: '',
          confirmNewPassword: ''
        });
        setProfileError('');
        setShowProfileUpdate(true);
      };

      const updateProfile = () => {
        setProfileError('');
        
        const savedCreds = JSON.parse(localStorage.getItem('userCredentials'));
        
        // If trying to change password, verify current password
        if (profileForm.newPassword) {
          if (!profileForm.currentPassword) {
            setProfileError('Please enter your current password');
            return;
          }
          if (profileForm.currentPassword !== savedCreds.password) {
            setProfileError('Current password is incorrect');
            return;
          }
          if (profileForm.newPassword.length < 6) {
            setProfileError('New password must be at least 6 characters');
            return;
          }
          if (profileForm.newPassword !== profileForm.confirmNewPassword) {
            setProfileError('New passwords do not match');
            return;
          }
        }

        // Update credentials
        const updatedCreds = {
          ...savedCreds,
          fullName: profileForm.fullName,
          email: profileForm.email,
          password: profileForm.newPassword || savedCreds.password
        };

        localStorage.setItem('userCredentials', JSON.stringify(updatedCreds));
        setFullName(profileForm.fullName);
        setEmail(profileForm.email);
        
        setShowProfileUpdate(false);
        setProfileForm({
          fullName: '',
          email: '',
          currentPassword: '',
          newPassword: '',
          confirmNewPassword: ''
        });
      };

      const togglePasswordVisibility = (id) => {
        setShowPasswords(prev => ({ ...prev, [id]: !prev[id] }));
      };

      const calculateStatus = (dueDate, paid) => {
        if (!dueDate) return null;
        if (paid) return 'paid';
        const today = new Date();
        const parts = dueDate.split('-');
        const due = new Date(parseInt(parts[0]), parseInt(parts[1]) - 1, parseInt(parts[2]));
        const daysUntil = Math.ceil((due - today) / (1000 * 60 * 60 * 24));
        
        if (daysUntil < 0) return 'overdue';
        if (daysUntil <= 3) return 'due-soon';
        return 'upcoming';
      };

      const getStatusColor = (status) => {
        switch(status) {
          case 'overdue': return 'bg-red-100 text-red-800 border-red-300';
          case 'due-soon': return 'bg-yellow-100 text-yellow-800 border-yellow-300';
          case 'paid': return 'bg-green-100 text-green-800 border-green-300';
          default: return 'bg-blue-100 text-blue-800 border-blue-300';
        }
      };

      const filteredBills = bills.filter(bill => {
        if (selectedCategory !== 'all' && bill.category !== selectedCategory) return false;
        if (view === 'upcoming') return !bill.paid;
        if (view === 'paid') return bill.paid;
        return true;
      });

      const totalDue = filteredBills
        .filter(bill => !bill.paid && bill.amount)
        .reduce((sum, bill) => sum + parseFloat(bill.amount || 0), 0);
      
      const totalBalance = filteredBills
        .filter(bill => bill.type === 'account')
        .reduce((sum, bill) => sum + parseFloat(bill.balance || 0), 0);

      const categories = ['all', 'personal', 'business1', 'business2', 'business3'];

      if (!isLoggedIn) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
            <div className="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
              <div className="text-center mb-8">
                <div className="bg-indigo-600 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 text-3xl">
                  💰
                </div>
                <h1 className="text-3xl font-bold text-gray-800">Bill Tracker</h1>
                <p className="text-gray-600 mt-2">
                  {isSignupMode ? 'Create your account' : 'Welcome back'}
                </p>
              </div>
              <div className="space-y-4">
                {loginError && (
                  <div className="p-3 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2">
                    <span className="text-red-600">⚠️</span>
                    <p className="text-sm text-red-800">{loginError}</p>
                  </div>
                )}
                
                {isSignupMode && (
                  <>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">Full Name (optional)</label>
                      <input
                        type="text"
                        value={fullName}
                        onChange={(e) => setFullName(e.target.value)}
                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        placeholder="John Doe"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">Email (optional)</label>
                      <input
                        type="email"
                        value={email}
                        onChange={(e) => setEmail(e.target.value)}
                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        placeholder="john@example.com"
                      />
                    </div>
                  </>
                )}
                
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Username *</label>
                  <input
                    type="text"
                    value={username}
                    onChange={(e) => setUsername(e.target.value)}
                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                    placeholder="Enter username"
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Password *</label>
                  <input
                    type="password"
                    value={password}
                    onChange={(e) => setPassword(e.target.value)}
                    onKeyPress={(e) => e.key === 'Enter' && (isSignupMode ? handleSignup() : handleLogin())}
                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                    placeholder={isSignupMode ? "Minimum 6 characters" : "Enter password"}
                  />
                </div>
                
                {isSignupMode && (
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">Confirm Password *</label>
                    <input
                      type="password"
                      value={confirmPassword}
                      onChange={(e) => setConfirmPassword(e.target.value)}
                      onKeyPress={(e) => e.key === 'Enter' && handleSignup()}
                      className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                      placeholder="Re-enter password"
                    />
                  </div>
                )}
                
                <button
                  onClick={isSignupMode ? handleSignup : handleLogin}
                  className="w-full bg-indigo-600 text-white py-3 rounded-lg hover:bg-indigo-700 transition font-semibold"
                >
                  {isSignupMode ? 'Create Account' : 'Login'}
                </button>
                
                <div className="text-center">
                  <button
                    onClick={() => {
                      setIsSignupMode(!isSignupMode);
                      setLoginError('');
                      setPassword('');
                      setConfirmPassword('');
                    }}
                    className="text-sm text-indigo-600 hover:text-indigo-700 font-medium"
                  >
                    {isSignupMode 
                      ? 'Already have an account? Login' 
                      : 'Need an account? Sign up'}
                  </button>
                </div>
              </div>
            </div>
          </div>
        );
      }

      return (
        <div className="min-h-screen bg-gray-50">
          <header className="bg-white shadow-sm border-b">
            <div className="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center flex-wrap gap-2">
              <div className="flex items-center gap-3">
                <div className="bg-indigo-600 p-2 rounded-lg text-2xl">
                  💰
                </div>
                <div>
                  <h1 className="text-2xl font-bold text-gray-800">Bill Tracker</h1>
                  <p className="text-sm text-gray-600">Welcome, {fullName || username}</p>
                </div>
              </div>
              <div className="flex gap-2">
                <button
                  onClick={() => setShowSettings(true)}
                  className="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition flex items-center gap-2"
                >
                  <span>⚙️</span>
                  <span className="hidden sm:inline">Settings</span>
                </button>
                <button
                  onClick={handleLogout}
                  className="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition"
                >
                  Logout
                </button>
              </div>
            </div>
          </header>

          <main className="max-w-7xl mx-auto p-4 md:p-6">
            <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
              <div className="bg-white rounded-xl shadow p-6 border-l-4 border-indigo-500">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-gray-600 text-sm font-medium">Total Due</p>
                    <p className="text-3xl font-bold text-gray-800">${totalDue.toFixed(2)}</p>
                  </div>
                  <span className="text-3xl">📈</span>
                </div>
              </div>
              <div className="bg-white rounded-xl shadow p-6 border-l-4 border-teal-500">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-gray-600 text-sm font-medium">Total Balance</p>
                    <p className="text-3xl font-bold text-gray-800">${totalBalance.toFixed(2)}</p>
                  </div>
                  <span className="text-3xl">💰</span>
                </div>
              </div>
              <div className="bg-white rounded-xl shadow p-6 border-l-4 border-yellow-500">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-gray-600 text-sm font-medium">Upcoming Bills</p>
                    <p className="text-3xl font-bold text-gray-800">
                      {bills.filter(b => b.type !== 'account' && !b.paid).length}
                    </p>
                  </div>
                  <span className="text-3xl">📅</span>
                </div>
              </div>
              <div className="bg-white rounded-xl shadow p-6 border-l-4 border-green-500">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-gray-600 text-sm font-medium">Accounts</p>
                    <p className="text-3xl font-bold text-gray-800">
                      {bills.filter(b => b.type === 'account').length}
                    </p>
                  </div>
                  <span className="text-3xl">🏦</span>
                </div>
              </div>
            </div>

            <div className="bg-white rounded-xl shadow mb-6">
              <div className="p-4 border-b flex flex-wrap gap-2 items-center justify-between">
                <div className="flex gap-2 flex-wrap">
                  <button
                    onClick={() => { setView('upcoming'); setShowCalendar(false); }}
                    className={`px-4 py-2 rounded-lg transition ${view === 'upcoming' && !showCalendar ? 'bg-indigo-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}
                  >
                    Upcoming
                  </button>
                  <button
                    onClick={() => { setView('paid'); setShowCalendar(false); }}
                    className={`px-4 py-2 rounded-lg transition ${view === 'paid' && !showCalendar ? 'bg-indigo-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}
                  >
                    Paid
                  </button>
                  <button
                    onClick={() => { setView('all'); setShowCalendar(false); }}
                    className={`px-4 py-2 rounded-lg transition ${view === 'all' && !showCalendar ? 'bg-indigo-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}
                  >
                    All Bills
                  </button>
                  <button
                    onClick={() => setShowCalendar(true)}
                    className={`px-4 py-2 rounded-lg transition flex items-center gap-2 ${showCalendar ? 'bg-indigo-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}
                  >
                    <span>📅</span>
                    Calendar
                  </button>
                </div>
                <button
                  onClick={() => setShowAddBill(true)}
                  className="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition flex items-center gap-2"
                >
                  <span>➕</span>
                  Add New
                </button>
              </div>

              <div className="p-4 border-b">
                <div className="flex gap-2 flex-wrap">
                  {categories.map(cat => (
                    <button
                      key={cat}
                      onClick={() => setSelectedCategory(cat)}
                      className={`px-4 py-2 rounded-lg transition capitalize ${
                        selectedCategory === cat 
                          ? 'bg-indigo-100 text-indigo-700 border border-indigo-300' 
                          : 'bg-gray-50 text-gray-700 hover:bg-gray-100 border border-gray-200'
                      }`}
                    >
                      {cat === 'all' ? 'All' : categoryNames[cat]}
                    </button>
                  ))}
                </div>
              </div>

              {showCalendar ? (
                <div className="p-6">
                  <div className="flex items-center justify-between mb-6">
                    <button
                      onClick={() => changeMonth(-1)}
                      className="p-2 hover:bg-gray-100 rounded-lg transition"
                    >
                      ← Previous
                    </button>
                    <div className="text-center">
                      <h3 className="text-2xl font-bold text-gray-800">
                        {calendarDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}
                      </h3>
                      <button
                        onClick={goToToday}
                        className="text-sm text-indigo-600 hover:text-indigo-700 mt-1"
                      >
                        Today
                      </button>
                    </div>
                    <button
                      onClick={() => changeMonth(1)}
                      className="p-2 hover:bg-gray-100 rounded-lg transition"
                    >
                      Next →
                    </button>
                  </div>

                  <div className="grid grid-cols-7 gap-2">
                    {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => (
                      <div key={day} className="text-center font-semibold text-gray-600 text-sm py-2">
                        {day}
                      </div>
                    ))}
                    
                    {getDaysInMonth(calendarDate).map((date, idx) => {
                      if (!date) {
                        return <div key={`empty-${idx}`} className="aspect-square" />;
                      }
                      
                      const dayBills = getBillsForDate(date);
                      const isToday = date.toDateString() === new Date().toDateString();
                      const hasUnpaidBills = dayBills.some(b => !b.paid);
                      const hasPaidBills = dayBills.some(b => b.paid);
                      
                      return (
                        <div
                          key={idx}
                          onClick={() => handleDayClick(date)}
                          className={`aspect-square border rounded-lg p-2 transition cursor-pointer ${
                            isToday ? 'border-indigo-500 bg-indigo-50' : 'border-gray-200 hover:border-indigo-300 hover:bg-gray-50'
                          }`}
                        >
                          <div className="text-sm font-medium text-gray-700 mb-1">
                            {date.getDate()}
                          </div>
                          {dayBills.length > 0 && (
                            <div className="space-y-1">
                              {dayBills.slice(0, 2).map(bill => {
                                const status = calculateStatus(bill.dueDate, bill.paid);
                                return (
                                  <div
                                    key={bill.id}
                                    className={`text-xs px-1 py-0.5 rounded truncate ${
                                      status === 'paid' ? 'bg-green-100 text-green-800' :
                                      status === 'overdue' ? 'bg-red-100 text-red-800' :
                                      status === 'due-soon' ? 'bg-yellow-100 text-yellow-800' :
                                      'bg-blue-100 text-blue-800'
                                    }`}
                                    title={bill.vendor}
                                  >
                                    {bill.vendor}
                                  </div>
                                );
                              })}
                              {dayBills.length > 2 && (
                                <div className="text-xs text-gray-600 px-1">
                                  +{dayBills.length - 2} more
                                </div>
                              )}
                            </div>
                          )}
                        </div>
                      );
                    })}
                  </div>
                </div>
              ) : (
                <>
                  <div className="overflow-x-auto">
                <table className="w-full">
                  <thead className="bg-gray-50 border-b">
                    <tr>
                      <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">Type</th>
                      <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">Status</th>
                      <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">Vendor/Account</th>
                      <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">Category</th>
                      <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">Details</th>
                      <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">Credentials</th>
                      <th className="px-4 py-3 text-left text-sm font-semibold text-gray-700">Actions</th>
                    </tr>
                  </thead>
                  <tbody className="divide-y">
                    {filteredBills.length === 0 ? (
                      <tr>
                        <td colSpan="7" className="px-4 py-8 text-center text-gray-500">
                          No items found. Add your first bill or account to get started!
                        </td>
                      </tr>
                    ) : (
                      filteredBills.map(bill => {
                        const status = calculateStatus(bill.dueDate, bill.paid);
                        const isBill = bill.type !== 'account';
                        return (
                          <tr key={bill.id} className="hover:bg-gray-50">
                            <td className="px-4 py-4">
                              <span className={`px-2 py-1 rounded text-xs font-semibold ${
                                isBill ? 'bg-purple-100 text-purple-700' : 'bg-teal-100 text-teal-700'
                              }`}>
                                {isBill ? '📄 Bill' : '💰 Account'}
                              </span>
                            </td>
                            <td className="px-4 py-4">
                              {(isBill || bill.dueDate) && (
                                <span className={`px-3 py-1 rounded-full text-xs font-semibold border ${getStatusColor(status)}`}>
                                  {status === 'due-soon' ? 'Due Soon' : status.charAt(0).toUpperCase() + status.slice(1)}
                                </span>
                              )}
                            </td>
                            <td className="px-4 py-4">
                              <div className="font-medium text-gray-800">{bill.vendor}</div>
                              {bill.notes && <div className="text-sm text-gray-500">{bill.notes}</div>}
                              {bill.isRecurring && isBill && <div className="text-xs text-indigo-600 mt-1">🔄 Recurring</div>}
                              {bill.isRecurring && !isBill && bill.amount && bill.dueDate && (
                                <div className="text-xs text-indigo-600 mt-1">🔄 Recurring Payment</div>
                              )}
                              {!isBill && bill.accountType && (
                                <div className="text-xs text-gray-600 mt-1 capitalize">{bill.accountType}</div>
                              )}
                            </td>
                            <td className="px-4 py-4">
                              <span className="inline-flex items-center gap-1 px-2 py-1 bg-gray-100 rounded text-sm">
                                <span>{bill.category === 'personal' ? '👤' : '🏢'}</span>
                                {categoryNames[bill.category]}
                              </span>
                            </td>
                            <td className="px-4 py-4">
                              {isBill ? (
                                <div>
                                  <div className="text-sm text-gray-600">Due: {formatDate(bill.dueDate)}</div>
                                  <div className="font-semibold text-gray-800">${parseFloat(bill.amount).toFixed(2)}</div>
                                </div>
                              ) : (
                                <div className="space-y-1">
                                  <div className="font-semibold text-gray-800">
                                    Balance: ${parseFloat(bill.balance || 0).toFixed(2)}
                                  </div>
                                  {bill.interestRate && (
                                    <div className="text-sm text-gray-600">
                                      Interest: {bill.interestRate}%
                                    </div>
                                  )}
                                  {bill.term && (
                                    <div className="text-sm text-gray-600">
                                      Term: {bill.term} months
                                    </div>
                                  )}
                                  {bill.dueDate && bill.amount && (
                                    <div className="text-sm text-gray-600">
                                      Payment: ${parseFloat(bill.amount).toFixed(2)} on {formatDate(bill.dueDate)}
                                    </div>
                                  )}
                                </div>
                              )}
                            </td>
                            <td className="px-4 py-4">
                              <div className="space-y-1 text-sm">
                                {bill.email && <div className="text-gray-600">Email: {bill.email}</div>}
                                {bill.username && <div className="text-gray-600">User: {bill.username}</div>}
                                {bill.password && (
                                  <div className="flex items-center gap-2">
                                    <span className="text-gray-600">
                                      Pass: {showPasswords[bill.id] ? bill.password : '••••••••'}
                                    </span>
                                    <button
                                      onClick={() => togglePasswordVisibility(bill.id)}
                                      className="text-indigo-600 hover:text-indigo-700"
                                    >
                                      {showPasswords[bill.id] ? '🙈' : '👁️'}
                                    </button>
                                  </div>
                                )}
                              </div>
                            </td>
                            <td className="px-4 py-4">
                              <div className="flex gap-2">
                                <button
                                  onClick={() => startEditingBill(bill)}
                                  className="p-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition"
                                  title="Edit"
                                >
                                  ✏️
                                </button>
                                {!isBill && (
                                  <button
                                    onClick={() => openBalanceUpdate(bill.id)}
                                    className="p-2 bg-purple-100 text-purple-700 rounded-lg hover:bg-purple-200 transition"
                                    title="Update balance"
                                  >
                                    💰
                                  </button>
                                )}
                                {(bill.history && bill.history.length > 0) && (
                                  <button
                                    onClick={() => openHistory(bill)}
                                    className="p-2 bg-amber-100 text-amber-700 rounded-lg hover:bg-amber-200 transition"
                                    title="View history"
                                  >
                                    📜
                                  </button>
                                )}
                                {(isBill || (bill.amount && bill.dueDate)) && (
                                  <button
                                    onClick={() => togglePaid(bill.id)}
                                    className={`p-2 rounded-lg transition ${
                                      bill.paid 
                                        ? 'bg-gray-100 text-gray-600 hover:bg-gray-200' 
                                        : 'bg-green-100 text-green-700 hover:bg-green-200'
                                    }`}
                                    title={bill.paid ? 'Mark as unpaid' : 'Mark as paid'}
                                  >
                                    ✓
                                  </button>
                                )}
                                <button
                                  onClick={() => deleteBill(bill.id)}
                                  className="p-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition"
                                  title="Delete"
                                >
                                  🗑️
                                </button>
                              </div>
                            </td>
                          </tr>
                        );
                      })
                    )}
                  </tbody>
                </table>
              </div>
                </>
              )}
            </div>
          </main>

          {showSettings && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
              <div className="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                <div className="p-6 border-b flex justify-between items-center">
                  <h2 className="text-2xl font-bold text-gray-800">Settings</h2>
                  <button
                    onClick={() => {
                      setShowSettings(false);
                      setEditingCategory(null);
                      setTempCategoryName('');
                    }}
                    className="p-2 hover:bg-gray-100 rounded-lg transition text-2xl"
                  >
                    ✕
                  </button>
                </div>
                
                <div className="p-6 border-b">
                  <div className="flex items-center justify-between mb-4">
                    <div>
                      <h3 className="text-lg font-semibold text-gray-800">My Profile</h3>
                      <p className="text-sm text-gray-600">Manage your account information</p>
                    </div>
                    <button
                      onClick={openProfileUpdate}
                      className="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition flex items-center gap-2"
                    >
                      <span>✏️</span>
                      Edit Profile
                    </button>
                  </div>
                  <div className="bg-gray-50 rounded-lg p-4 space-y-2">
                    <div className="flex items-start gap-2">
                      <span className="text-gray-600 text-sm font-medium w-24">Username:</span>
                      <span className="text-gray-800 font-medium">{username}</span>
                    </div>
                    {fullName && (
                      <div className="flex items-start gap-2">
                        <span className="text-gray-600 text-sm font-medium w-24">Full Name:</span>
                        <span className="text-gray-800">{fullName}</span>
                      </div>
                    )}
                    {email && (
                      <div className="flex items-start gap-2">
                        <span className="text-gray-600 text-sm font-medium w-24">Email:</span>
                        <span className="text-gray-800">{email}</span>
                      </div>
                    )}
                  </div>
                </div>
                
                <div className="p-6">
                  <h3 className="text-lg font-semibold text-gray-800 mb-4">Category Names</h3>
                  <p className="text-sm text-gray-600 mb-4">Click the edit icon to rename your categories</p>
                  <div className="space-y-3">
                    {Object.keys(categoryNames).map(catKey => (
                      <div key={catKey} className="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                        <div className="flex-1">
                          {editingCategory === catKey ? (
                            <input
                              type="text"
                              value={tempCategoryName}
                              onChange={(e) => setTempCategoryName(e.target.value)}
                              onKeyPress={(e) => {
                                if (e.key === 'Enter') saveCategoryName();
                              }}
                              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                              autoFocus
                            />
                          ) : (
                            <div className="flex items-center gap-2">
                              <span>{catKey === 'personal' ? '👤' : '🏢'}</span>
                              <span className="font-medium text-gray-800">{categoryNames[catKey]}</span>
                            </div>
                          )}
                        </div>
                        <div className="flex gap-2">
                          {editingCategory === catKey ? (
                            <>
                              <button
                                onClick={saveCategoryName}
                                className="p-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition"
                              >
                                ✓
                              </button>
                              <button
                                onClick={cancelEditingCategory}
                                className="p-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition"
                              >
                                ✕
                              </button>
                            </>
                          ) : (
                            <button
                              onClick={() => startEditingCategory(catKey)}
                              className="p-2 bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 transition"
                            >
                              ✏️
                            </button>
                          )}
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
                <div className="p-6 border-t flex justify-end">
                  <button
                    onClick={() => {
                      setShowSettings(false);
                      setEditingCategory(null);
                      setTempCategoryName('');
                    }}
                    className="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition"
                  >
                    Done
                  </button>
                </div>
              </div>
            </div>
          )}

          {showAddBill && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
              <div className="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                <div className="p-6 border-b flex justify-between items-center">
                  <h2 className="text-2xl font-bold text-gray-800">
                    {editingBill 
                      ? `Edit ${editingBill.type === 'account' ? 'Account' : 'Bill'}` 
                      : `Add New ${newBill.type === 'account' ? 'Account' : 'Bill'}`
                    }
                  </h2>
                  <button
                    onClick={cancelEdit}
                    className="p-2 hover:bg-gray-100 rounded-lg transition text-2xl"
                  >
                    ✕
                  </button>
                </div>
                <div className="p-6 space-y-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">Type *</label>
                    <div className="flex gap-4">
                      <label className="flex items-center gap-2 cursor-pointer">
                        <input
                          type="radio"
                          value="bill"
                          checked={newBill.type === 'bill'}
                          onChange={(e) => setNewBill({...newBill, type: e.target.value})}
                          className="w-4 h-4 text-indigo-600"
                        />
                        <span className="text-sm font-medium text-gray-700">📄 Bill (scheduled payment)</span>
                      </label>
                      <label className="flex items-center gap-2 cursor-pointer">
                        <input
                          type="radio"
                          value="account"
                          checked={newBill.type === 'account'}
                          onChange={(e) => setNewBill({...newBill, type: e.target.value})}
                          className="w-4 h-4 text-indigo-600"
                        />
                        <span className="text-sm font-medium text-gray-700">💰 Account (balance tracking)</span>
                      </label>
                    </div>
                  </div>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">
                        {newBill.type === 'bill' ? 'Vendor/Service' : 'Account Name'} *
                      </label>
                      <input
                        type="text"
                        value={newBill.vendor}
                        onChange={(e) => setNewBill({...newBill, vendor: e.target.value})}
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        placeholder={newBill.type === 'bill' ? 'Netflix, Electric Company, etc.' : 'Mortgage, Credit Card, etc.'}
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">Category *</label>
                      <select
                        value={newBill.category}
                        onChange={(e) => setNewBill({...newBill, category: e.target.value})}
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                      >
                        <option value="personal">{categoryNames.personal}</option>
                        <option value="business1">{categoryNames.business1}</option>
                        <option value="business2">{categoryNames.business2}</option>
                        <option value="business3">{categoryNames.business3}</option>
                      </select>
                    </div>
                    
                    {newBill.type === 'account' && (
                      <>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">Account Type</label>
                          <select
                            value={newBill.accountType}
                            onChange={(e) => setNewBill({...newBill, accountType: e.target.value})}
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                          >
                            <option value="loan">Loan</option>
                            <option value="mortgage">Mortgage</option>
                            <option value="credit-card">Credit Card</option>
                            <option value="savings">Savings Account</option>
                            <option value="investment">Investment Account</option>
                            <option value="other">Other</option>
                          </select>
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">Current Balance *</label>
                          <input
                            type="number"
                            step="0.01"
                            value={newBill.balance}
                            onChange={(e) => setNewBill({...newBill, balance: e.target.value})}
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                            placeholder="0.00"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">Interest Rate (%)</label>
                          <input
                            type="number"
                            step="0.01"
                            value={newBill.interestRate}
                            onChange={(e) => setNewBill({...newBill, interestRate: e.target.value})}
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                            placeholder="5.5"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">Term (months)</label>
                          <input
                            type="number"
                            value={newBill.term}
                            onChange={(e) => setNewBill({...newBill, term: e.target.value})}
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                            placeholder="360"
                          />
                        </div>
                      </>
                    )}
                    
                    {newBill.type === 'bill' ? (
                      <>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">Amount *</label>
                          <input
                            type="number"
                            step="0.01"
                            value={newBill.amount}
                            onChange={(e) => setNewBill({...newBill, amount: e.target.value})}
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                            placeholder="0.00"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">Due Date *</label>
                          <input
                            type="date"
                            value={newBill.dueDate}
                            onChange={(e) => setNewBill({...newBill, dueDate: e.target.value})}
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">Frequency</label>
                          <select
                            value={newBill.frequency}
                            onChange={(e) => setNewBill({...newBill, frequency: e.target.value})}
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                          >
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                            <option value="quarterly">Quarterly</option>
                            <option value="yearly">Yearly</option>
                          </select>
                        </div>
                      </>
                    ) : (
                      <>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">Payment Amount (optional)</label>
                          <input
                            type="number"
                            step="0.01"
                            value={newBill.amount}
                            onChange={(e) => setNewBill({...newBill, amount: e.target.value})}
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                            placeholder="0.00"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">Payment Due Date (optional)</label>
                          <input
                            type="date"
                            value={newBill.dueDate}
                            onChange={(e) => setNewBill({...newBill, dueDate: e.target.value})}
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">Payment Frequency</label>
                          <select
                            value={newBill.frequency}
                            onChange={(e) => setNewBill({...newBill, frequency: e.target.value})}
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                          >
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                            <option value="quarterly">Quarterly</option>
                            <option value="yearly">Yearly</option>
                          </select>
                        </div>
                      </>
                    )}
                    
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">Email</label>
                      <input
                        type="email"
                        value={newBill.email}
                        onChange={(e) => setNewBill({...newBill, email: e.target.value})}
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        placeholder="your@email.com"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">Username</label>
                      <input
                        type="text"
                        value={newBill.username}
                        onChange={(e) => setNewBill({...newBill, username: e.target.value})}
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        placeholder="account username"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-2">Password</label>
                      <input
                        type="password"
                        value={newBill.password}
                        onChange={(e) => setNewBill({...newBill, password: e.target.value})}
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        placeholder="account password"
                      />
                    </div>
                  </div>
                  
                  {newBill.type === 'bill' && (
                    <div>
                      <label className="flex items-center gap-2 cursor-pointer">
                        <input
                          type="checkbox"
                          checked={newBill.isRecurring}
                          onChange={(e) => setNewBill({...newBill, isRecurring: e.target.checked})}
                          className="w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"
                        />
                        <span className="text-sm font-medium text-gray-700">
                          Recurring Bill (automatically create next bill when marked as paid)
                        </span>
                      </label>
                    </div>
                  )}
                  
                  {newBill.type === 'account' && newBill.amount && newBill.dueDate && (
                    <div>
                      <label className="flex items-center gap-2 cursor-pointer">
                        <input
                          type="checkbox"
                          checked={newBill.isRecurring}
                          onChange={(e) => setNewBill({...newBill, isRecurring: e.target.checked})}
                          className="w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"
                        />
                        <span className="text-sm font-medium text-gray-700">
                          Recurring Payment (automatically create next payment & reduce balance when marked as paid)
                        </span>
                      </label>
                    </div>
                  )}
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">Notes</label>
                    <textarea
                      value={newBill.notes}
                      onChange={(e) => setNewBill({...newBill, notes: e.target.value})}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                      rows="3"
                      placeholder="Additional notes..."
                    />
                  </div>
                </div>
                <div className="p-6 border-t flex gap-3 justify-end">
                  <button
                    onClick={cancelEdit}
                    className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition"
                  >
                    Cancel
                  </button>
                  <button
                    onClick={editingBill ? updateBill : addBill}
                    className="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition"
                  >
                    {editingBill 
                      ? `Update ${editingBill.type === 'account' ? 'Account' : 'Bill'}` 
                      : `Add ${newBill.type === 'account' ? 'Account' : 'Bill'}`
                    }
                  </button>
                </div>
              </div>
            </div>
          )}

          {showBalanceUpdate && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
              <div className="bg-white rounded-xl shadow-2xl max-w-md w-full">
                <div className="p-6 border-b">
                  <h2 className="text-2xl font-bold text-gray-800">Update Balance</h2>
                  <p className="text-sm text-gray-600 mt-2">Enter the new balance for this account</p>
                </div>
                <div className="p-6">
                  <label className="block text-sm font-medium text-gray-700 mb-2">New Balance *</label>
                  <input
                    type="number"
                    step="0.01"
                    value={newBalance}
                    onChange={(e) => setNewBalance(e.target.value)}
                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                    placeholder="0.00"
                    autoFocus
                  />
                </div>
                <div className="p-6 border-t flex gap-3 justify-end">
                  <button
                    onClick={() => {
                      setShowBalanceUpdate(false);
                      setBalanceUpdateId(null);
                      setNewBalance('');
                    }}
                    className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition"
                  >
                    Cancel
                  </button>
                  <button
                    onClick={updateBalance}
                    className="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition"
                  >
                    Update Balance
                  </button>
                </div>
              </div>
            </div>
          )}

          {showHistory && historyBill && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
              <div className="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden flex flex-col">
                <div className="p-6 border-b">
                  <div className="flex justify-between items-start">
                    <div>
                      <h2 className="text-2xl font-bold text-gray-800">Payment History</h2>
                      <p className="text-sm text-gray-600 mt-1">{historyBill.vendor}</p>
                    </div>
                    <button
                      onClick={() => {
                        setShowHistory(false);
                        setHistoryBill(null);
                      }}
                      className="p-2 hover:bg-gray-100 rounded-lg transition text-2xl"
                    >
                      ✕
                    </button>
                  </div>
                </div>
                <div className="flex-1 overflow-y-auto p-6">
                  {(!historyBill.history || historyBill.history.length === 0) ? (
                    <div className="text-center py-8 text-gray-500">
                      No payment history yet
                    </div>
                  ) : (
                    <div className="space-y-3">
                      {[...historyBill.history].reverse().map((entry, idx) => {
                        const date = new Date(entry.date);
                        const isPayment = entry.type === 'payment';
                        return (
                          <div key={idx} className={`p-4 rounded-lg border-l-4 ${
                            isPayment ? 'bg-green-50 border-green-500' : 'bg-blue-50 border-blue-500'
                          }`}>
                            <div className="flex justify-between items-start mb-2">
                              <div className="flex items-center gap-2">
                                <span className="text-2xl">{isPayment ? '💳' : '📊'}</span>
                                <div>
                                  <div className="font-semibold text-gray-800">
                                    {isPayment ? 'Payment Made' : 'Balance Updated'}
                                  </div>
                                  <div className="text-sm text-gray-600">
                                    {date.toLocaleDateString()} at {date.toLocaleTimeString()}
                                  </div>
                                </div>
                              </div>
                              {entry.amount && (
                                <div className="text-right">
                                  <div className="font-bold text-green-700">
                                    -${parseFloat(entry.amount).toFixed(2)}
                                  </div>
                                </div>
                              )}
                            </div>
                            {entry.previousBalance && entry.newBalance && (
                              <div className="flex items-center gap-2 text-sm mt-2 pt-2 border-t border-gray-200">
                                <span className="text-gray-600">Balance:</span>
                                <span className="font-medium text-gray-700">
                                  ${parseFloat(entry.previousBalance).toFixed(2)}
                                </span>
                                <span className="text-gray-400">→</span>
                                <span className="font-bold text-gray-800">
                                  ${parseFloat(entry.newBalance).toFixed(2)}
                                </span>
                              </div>
                            )}
                          </div>
                        );
                      })}
                    </div>
                  )}
                </div>
                <div className="p-6 border-t">
                  <button
                    onClick={() => {
                      setShowHistory(false);
                      setHistoryBill(null);
                    }}
                    className="w-full px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition"
                  >
                    Close
                  </button>
                </div>
              </div>
            </div>
          )}

          {selectedDayBills && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
              <div className="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden flex flex-col">
                <div className="p-6 border-b">
                  <div className="flex justify-between items-start">
                    <div>
                      <h2 className="text-2xl font-bold text-gray-800">
                        Bills for {selectedDayBills.date.toLocaleDateString('en-US', { 
                          weekday: 'long',
                          month: 'long', 
                          day: 'numeric',
                          year: 'numeric'
                        })}
                      </h2>
                      <p className="text-sm text-gray-600 mt-1">
                        {selectedDayBills.bills.length} {selectedDayBills.bills.length === 1 ? 'bill' : 'bills'} due
                      </p>
                    </div>
                    <button
                      onClick={() => setSelectedDayBills(null)}
                      className="p-2 hover:bg-gray-100 rounded-lg transition text-2xl"
                    >
                      ✕
                    </button>
                  </div>
                </div>
                <div className="flex-1 overflow-y-auto p-6">
                  <div className="space-y-3">
                    {selectedDayBills.bills.map(bill => {
                      const status = calculateStatus(bill.dueDate, bill.paid);
                      const isBill = bill.type !== 'account';
                      return (
                        <div key={bill.id} className="border rounded-lg p-4 hover:border-indigo-300 transition">
                          <div className="flex items-start justify-between mb-2">
                            <div className="flex-1">
                              <div className="flex items-center gap-2 mb-1">
                                <span className={`px-2 py-1 rounded text-xs font-semibold ${
                                  isBill ? 'bg-purple-100 text-purple-700' : 'bg-teal-100 text-teal-700'
                                }`}>
                                  {isBill ? '📄' : '💰'}
                                </span>
                                <h3 className="font-bold text-gray-800">{bill.vendor}</h3>
                              </div>
                              <div className="flex items-center gap-2 flex-wrap">
                                <span className={`px-2 py-1 rounded-full text-xs font-semibold border ${getStatusColor(status)}`}>
                                  {status === 'due-soon' ? 'Due Soon' : status.charAt(0).toUpperCase() + status.slice(1)}
                                </span>
                                <span className="text-sm text-gray-600">
                                  {categoryNames[bill.category]}
                                </span>
                              </div>
                            </div>
                            <div className="text-right">
                              <div className="text-2xl font-bold text-gray-800">
                                ${parseFloat(bill.amount || 0).toFixed(2)}
                              </div>
                              {bill.type === 'account' && bill.balance && (
                                <div className="text-sm text-gray-600">
                                  Balance: ${parseFloat(bill.balance).toFixed(2)}
                                </div>
                              )}
                            </div>
                          </div>
                          
                          {bill.notes && (
                            <div className="text-sm text-gray-600 mb-3">
                              {bill.notes}
                            </div>
                          )}
                          
                          <div className="flex gap-2 pt-3 border-t">
                            <button
                              onClick={() => {
                                setSelectedDayBills(null);
                                startEditingBill(bill);
                              }}
                              className="px-3 py-1.5 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition text-sm font-medium"
                            >
                              Edit
                            </button>
                            {!isBill && (
                              <button
                                onClick={() => {
                                  setSelectedDayBills(null);
                                  openBalanceUpdate(bill.id);
                                }}
                                className="px-3 py-1.5 bg-purple-100 text-purple-700 rounded-lg hover:bg-purple-200 transition text-sm font-medium"
                              >
                                Update Balance
                              </button>
                            )}
                            {(isBill || (bill.amount && bill.dueDate)) && (
                              <button
                                onClick={() => {
                                  togglePaid(bill.id);
                                  // Refresh the day bills
                                  const updatedBills = getBillsForDate(selectedDayBills.date);
                                  if (updatedBills.length > 0) {
                                    setSelectedDayBills({ ...selectedDayBills, bills: updatedBills });
                                  } else {
                                    setSelectedDayBills(null);
                                  }
                                }}
                                className={`px-3 py-1.5 rounded-lg transition text-sm font-medium ${
                                  bill.paid 
                                    ? 'bg-gray-100 text-gray-600 hover:bg-gray-200' 
                                    : 'bg-green-100 text-green-700 hover:bg-green-200'
                                }`}
                              >
                                {bill.paid ? 'Mark Unpaid' : 'Mark Paid'}
                              </button>
                            )}
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
                <div className="p-6 border-t">
                  <button
                    onClick={() => setSelectedDayBills(null)}
                    className="w-full px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition"
                  >
                    Close
                  </button>
                </div>
              </div>
            </div>
          )}

          {showProfileUpdate && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
              <div className="bg-white rounded-xl shadow-2xl max-w-md w-full">
                <div className="p-6 border-b">
                  <h2 className="text-2xl font-bold text-gray-800">Update Profile</h2>
                  <p className="text-sm text-gray-600 mt-2">Update your account information</p>
                </div>
                <div className="p-6 space-y-4">
                  {profileError && (
                    <div className="p-3 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2">
                      <span className="text-red-600">⚠️</span>
                      <p className="text-sm text-red-800">{profileError}</p>
                    </div>
                  )}
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">Full Name</label>
                    <input
                      type="text"
                      value={profileForm.fullName}
                      onChange={(e) => setProfileForm({...profileForm, fullName: e.target.value})}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                      placeholder="John Doe"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input
                      type="email"
                      value={profileForm.email}
                      onChange={(e) => setProfileForm({...profileForm, email: e.target.value})}
                      className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                      placeholder="john@example.com"
                    />
                  </div>
                  
                  <div className="pt-4 border-t">
                    <h3 className="text-sm font-semibold text-gray-700 mb-3">Change Password (optional)</h3>
                    
                    <div className="space-y-3">
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">Current Password</label>
                        <input
                          type="password"
                          value={profileForm.currentPassword}
                          onChange={(e) => setProfileForm({...profileForm, currentPassword: e.target.value})}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                          placeholder="Enter current password"
                        />
                      </div>
                      
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">New Password</label>
                        <input
                          type="password"
                          value={profileForm.newPassword}
                          onChange={(e) => setProfileForm({...profileForm, newPassword: e.target.value})}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                          placeholder="Minimum 6 characters"
                        />
                      </div>
                      
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">Confirm New Password</label>
                        <input
                          type="password"
                          value={profileForm.confirmNewPassword}
                          onChange={(e) => setProfileForm({...profileForm, confirmNewPassword: e.target.value})}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                          placeholder="Re-enter new password"
                        />
                      </div>
                    </div>
                  </div>
                </div>
                <div className="p-6 border-t flex gap-3 justify-end">
                  <button
                    onClick={() => {
                      setShowProfileUpdate(false);
                      setProfileForm({
                        fullName: '',
                        email: '',
                        currentPassword: '',
                        newPassword: '',
                        confirmNewPassword: ''
                      });
                      setProfileError('');
                    }}
                    className="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition"
                  >
                    Cancel
                  </button>
                  <button
                    onClick={updateProfile}
                    className="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition"
                  >
                    Save Changes
                  </button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };

    ReactDOM.render(<BillTracker />, document.getElementById('root'));
  </script>
</body>
</html>
